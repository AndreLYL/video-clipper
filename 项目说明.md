# 视频裁剪工具 - 项目说明

## 项目概览

这是一个基于Python开发的视频裁剪工具，具有友好的图形界面，支持单点裁剪和批量裁剪功能。

### 主要特性
- ✓ 现代化的图形用户界面（Tkinter）
- ✓ 单点裁剪模式：精确裁剪单个时间点
- ✓ 批量裁剪模式：一次性处理多个时间点
- ✓ 智能时间验证和错误处理
- ✓ 多线程处理，界面不卡顿
- ✓ 进度条显示处理状态
- ✓ 可打包为独立EXE文件

---

## 文件结构

```
cursor_project/
├── video_clipper.py          # 主程序文件（核心代码）
├── requirements.txt           # Python依赖包列表
├── build.bat                  # Windows打包脚本
├── timestamp_example.txt      # 时间戳文件示例
├── quick_test.py             # 功能测试脚本
├── test_video_generator.py   # 测试视频生成器
├── README.md                  # 项目简介（英文）
├── 使用手册.md                # 详细使用说明（中文）
└── 项目说明.md                # 本文件
```

### 文件说明

#### 核心文件

**video_clipper.py** (400+ 行)
- 主程序，包含完整的GUI和视频处理逻辑
- 类：`VideoClipperApp` - 主应用程序类
- 主要方法：
  - `create_widgets()` - 创建UI界面
  - `process_single_clip()` - 单点裁剪处理
  - `process_batch_clip()` - 批量裁剪处理
  - `clip_video()` - 视频裁剪核心逻辑
  - `parse_time()` - 时间格式解析和验证

**requirements.txt**
```
moviepy==1.0.3        # 视频处理库
pillow>=10.0.0        # 图像处理支持
pyinstaller>=5.13.0   # EXE打包工具
```

#### 辅助文件

**build.bat**
- Windows批处理脚本
- 自动检查依赖
- 一键打包成EXE文件
- 输出位置：`dist/视频裁剪工具.exe`

**timestamp_example.txt**
- 批量裁剪时间戳文件示例
- 格式：`HH:MM:SS 描述`
- 支持注释（#开头）和空行

**quick_test.py**
- 自动化测试脚本
- 测试时间解析、格式验证等核心功能
- 运行：`python quick_test.py`

**test_video_generator.py**
- 生成带时间标记的测试视频
- 用于测试和演示
- 生成5分钟测试视频和配套时间戳文件

#### 文档文件

**README.md**
- 项目基础说明
- 快速开始指南
- 功能特点介绍

**使用手册.md**
- 详细的用户手册
- 分步操作教程
- 常见问题解答
- 技巧和建议

---

## 技术架构

### 技术栈
- **GUI框架**: Tkinter (Python标准库)
- **视频处理**: MoviePy (基于FFmpeg)
- **多线程**: threading (避免UI阻塞)
- **打包工具**: PyInstaller

### 核心功能流程

#### 单点裁剪流程
```
1. 用户输入视频起始时间（UTC）
2. 用户输入裁剪时间点
3. 计算相对时间 = 裁剪时间点 - 视频起始时间
4. 计算裁剪范围 = [相对时间-40秒, 相对时间+20秒]
5. 使用MoviePy裁剪视频
6. 保存为 HH-MM-SS.mp4
```

#### 批量裁剪流程
```
1. 用户输入视频起始时间（UTC）
2. 用户选择时间戳文件
3. 解析文件中的所有时间点
4. 对每个时间点：
   - 计算裁剪范围
   - 裁剪视频
   - 保存为 HH-MM-SS_描述.mp4
5. 显示成功和失败的统计
```

### 时间验证逻辑
```python
- 格式：HH:MM:SS
- 小时：0-23
- 分钟：0-59
- 秒：0-59
- 裁剪时间点必须晚于视频起始时间
```

### 线程安全设计
- 视频处理在后台线程执行
- UI更新使用 `root.after()` 确保线程安全
- 避免主线程阻塞

---

## 使用指南

### 快速开始

#### 1. 安装依赖
```bash
pip install -r requirements.txt
```

#### 2. 运行程序
```bash
python video_clipper.py
```

#### 3. 打包为EXE（可选）
```bash
build.bat
```

### 使用示例

#### 示例1：单点裁剪
```
场景：从一个2小时的会议录像中裁剪某个重要发言

操作：
1. 源视频：meeting_20241110.mp4
2. 目标目录：D:\clips\
3. 模式：单点裁剪
4. 视频起始时间：14:00:00 (下午2点)
5. 裁剪时间点：14:35:30 (重要发言时刻)
6. 点击"开始裁剪"

结果：
- 裁剪 14:34:50 ~ 14:35:50 的视频（60秒）
- 保存为：D:\clips\14-35-30.mp4
```

#### 示例2：批量裁剪
```
场景：从一个教学视频中裁剪所有知识点

准备时间戳文件 (timestamps.txt):
10:05:30 知识点1-基础概念
10:15:45 知识点2-实例演示
10:28:00 知识点3-进阶技巧
10:42:15 知识点4-常见问题

操作：
1. 源视频：lesson.mp4
2. 目标目录：D:\lessons\
3. 模式：批量裁剪
4. 视频起始时间：10:00:00
5. 时间戳文件：timestamps.txt
6. 点击"开始裁剪"

结果：
- D:\lessons\10-05-30_知识点1-基础概念.mp4
- D:\lessons\10-15-45_知识点2-实例演示.mp4
- D:\lessons\10-28-00_知识点3-进阶技巧.mp4
- D:\lessons\10-42-15_知识点4-常见问题.mp4
```

---

## 测试

### 运行单元测试
```bash
python quick_test.py
```

测试内容：
- ✓ 时间格式解析
- ✓ 时间范围验证
- ✓ 秒数转换
- ✓ 裁剪时间计算

### 生成测试视频
```bash
python test_video_generator.py
```

生成文件：
- `test_video.mp4` - 5分钟测试视频
- `test_timestamps.txt` - 测试时间戳文件

---

## 调试说明

### 调试步骤

1. **验证依赖安装**
```bash
pip list | findstr "moviepy pillow"
```

2. **运行功能测试**
```bash
python quick_test.py
```

3. **生成测试数据**
```bash
python test_video_generator.py
```

4. **测试单点裁剪**
- 使用生成的 `test_video.mp4`
- 视频起始时间：10:00:00
- 测试裁剪点：10:01:00

5. **测试批量裁剪**
- 使用生成的 `test_timestamps.txt`
- 检查输出目录是否有4个视频文件

### 常见问题排查

**问题1：导入错误**
```
ModuleNotFoundError: No module named 'moviepy'
```
解决：
```bash
pip install -r requirements.txt
```

**问题2：视频处理失败**
- 检查视频文件是否完整
- 确认时间参数在合理范围内
- 查看控制台错误信息

**问题3：中文显示乱码**
- 确保系统支持UTF-8
- Windows用户可能需要修改控制台编码

---

## 性能优化建议

### 处理速度
- 1分钟视频约需10-30秒处理时间
- 处理速度取决于：
  - 视频分辨率
  - 编码格式
  - CPU性能
  - 硬盘读写速度

### 优化建议
1. 关闭其他占用CPU的程序
2. 使用SSD硬盘存储视频
3. 批量处理时分批进行（每次20-30个）
4. 确保足够的硬盘空间（至少2倍视频大小）

---

## 扩展开发

### 如何修改裁剪时长

默认：前40秒 + 后20秒 = 60秒

修改 `video_clipper.py`：
```python
# 找到这两行（在 process_single_clip 和 process_batch_clip 中）
start_time = relative_seconds - 40  # 改为你想要的前置秒数
end_time = relative_seconds + 20    # 改为你想要的后置秒数
```

### 添加新的输出格式

修改 `clip_video()` 方法中的编码参数：
```python
clip.write_videofile(
    output_path, 
    codec="libx264",      # 视频编码
    audio_codec="aac",    # 音频编码
    bitrate="5000k"       # 码率（可选）
)
```

### 添加自动裁剪模式

这是预留功能，可以根据需求实现：
- 场景检测自动裁剪
- 音量变化检测
- 人脸识别标记
- AI内容分析

---

## 版本历史

### v1.0 (当前版本)
- ✓ 基础GUI界面
- ✓ 单点裁剪功能
- ✓ 批量裁剪功能
- ✓ 时间验证和错误处理
- ✓ 多线程处理
- ✓ 测试脚本
- ✓ 完整文档

### 计划功能（未来版本）
- 预览功能
- 自动裁剪模式
- 视频时长自动检测
- 进度百分比显示
- 更多输出格式支持
- 视频预览截图

---

## 许可和使用

本项目仅供学习和个人使用。

### 依赖库许可
- MoviePy: MIT License
- Pillow: HPND License
- PyInstaller: GPL License

---

## 支持和反馈

如有问题或建议，请：
1. 查阅 `使用手册.md`
2. 运行 `quick_test.py` 进行诊断
3. 检查是否为已知问题
4. 保存错误截图和日志

---

**开发完成日期**: 2024年11月10日

**测试状态**: ✓ 所有核心功能测试通过

**可用状态**: ✓ 可立即使用

